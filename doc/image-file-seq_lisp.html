<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="./robodoc.css" type="text/css" />
<script src="./robodoc.js"></script>
<title>image-file-seq.lisp</title>
<!-- Source: ./src/image-file-seq.lisp -->
<!-- Generated with ROBODoc Version 4.99.44 (Nov 13 2022) -->
</head>
<body>
<div id="logo">
<a name="robo_top_of_doc"></a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./toc_index.html#top">Table of Contents</a>
<a class="menuitem" href="./robo_sourcefiles.html#top">Sourcefiles</a>
<a class="menuitem" href="./masterindex.html#top">Index</a>
<a class="menuitem" href="./robo_generics.html#top">Generics</a>
<a class="menuitem" href="./robo_classes.html#top">Classes</a>
<a class="menuitem" href="./robo_functions.html#top">Functions</a>
<a class="menuitem" href="./robo_modules.html#top">Modules</a>
<a class="menuitem" href="./robo_methods.html#top">Methods</a>
<a class="menuitem" href="./robo_variables.html#top">Variables</a>
</div> <!-- navigation -->
<div id="content">
<hr />
<a name="apr2fimage2dfile2dseq"></a>
<a name="robo12"></a><h2>apr/image-file-seq [ Classes ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="./robo_classes.html#robo_top_of_doc">Classes</a> ]</p>
<p class="item_name">NAME</p>
<pre> <strong>image-file-seq</strong>
</pre>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-05
</pre>
<p class="item_name">PURPOSE</p>
<pre> Implementation of the <strong>image-file-seq</strong> class. This class holds information on
 a sequence of <a href="./image_lisp.html#robo11">image</a>-files, most likely sequential images used as frames of
 a video. 

 CLASS HIERARCHY
 <a href="./named-object_lisp.html#robo13">named-object</a> -&gt; <a href="./seq_lisp.html#robo16">seq</a> -&gt; <strong>image-file-seq</strong>

 $$ Last modified:  15:37:26 Sat Apr  6 2024 CEST
</pre>

<hr />
<a name="image2dfile2dseq2fget2dframe"></a>
<a name="robo39"></a><h2>image-file-seq/get-frame [ Methods ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo12">image-file-seq</a> ] [ <a href="./robo_methods.html#robo_top_of_doc">Methods</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-06
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This method returns the <a href="./image_lisp.html#robo11">image</a> file (as a pathname) for a secified frame in
 an <a href="#robo12">image-file-seq</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> - An <a href="#robo12">image-file-seq</a> object.
 - The datum of the frame to retrieve, in frames (integer) or seconds (when
   :in-seconds is T).
</pre>
<p class="item_name">OPTIONAL ARGUMENTS</p>
<pre> keyword-arguments:
 - :in-seconds. When T, the unit of datum will be interpreted as seconds,
   otherwise it will be treated as a frame index.
 - :warn? When T, prints additional warnings (e.g. when the frame does not
   exist in the <a href="./image_lisp.html#robo11">image</a>-file-<a href="./seq_lisp.html#robo16">seq</a>).
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> The pathname of the respective <a href="./image_lisp.html#robo11">image</a> file. 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((ifs (<a href="#robo41">make-image-file-seq-from-dir</a> "/tmp/tl-<a href="./seq_lisp.html#robo16">seq</a>/" :pattern "*.jpg")))
  (<strong>get-frame</strong> ifs 2 :in-seconds t))
;; =&gt; #P"/tmp/tl-<a href="./seq_lisp.html#robo16">seq</a>/0060.jpg"
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defmethod <strong>get-frame</strong> ((ifs <a href="./image_lisp.html#robo11">image</a>-file-<a href="./seq_lisp.html#robo16">seq</a>) datum
                      &amp;key
                        ;; when T, the datum is interpreted as a value in
                        ;; seconds relative to the fps of the <a href="#robo12">image-file-seq</a>
                        ;; otherwise it is an absolute frame
                        in-seconds
                        warn?)
</pre>

<hr />
<a name="image2dfile2dseq2fget2dimage"></a>
<a name="robo40"></a><h2>image-file-seq/get-image [ Methods ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo12">image-file-seq</a> ] [ <a href="./robo_methods.html#robo_top_of_doc">Methods</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-06
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> Like <a href="#robo39">get-frame</a>, this method tries to retrieve an <a href="./image_lisp.html#robo11">image</a> file from an
 <a href="#robo12">image-file-seq</a> at a given datum/index. Instead of returning the pathname of
 this file, it will instantiate and return an <a href="./image_lisp.html#robo11">image</a> object.
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> - An <a href="#robo12">image-file-seq</a> object.
 - The datum of the frame to retrieve, in frames (integer) or seconds (when
   :in-seconds is T).
</pre>
<p class="item_name">OPTIONAL ARGUMENTS</p>
<pre> keyword-arguments:
 - :id. The id of the <a href="./image_lisp.html#robo11">image</a> object.
 - :default-interpolation. The default interpolation method (used e.g. when
   changing the <a href="./image_lisp.html#robo11">image</a> dimensions via the (setf ...) methods.
   Default = (<a href="./globals_lisp.html#robo37">get-apr-config</a> :default-interpolation)
 - :in-seconds. When T, the unit of datum will be interpreted as seconds,
   otherwise it will be treated as a frame index.
 - :warn? When T, prints additional warnings (e.g. when the frame does not
   exist in the <a href="./image_lisp.html#robo11">image</a>-file-<a href="./seq_lisp.html#robo16">seq</a>).
</pre>
<p class="item_name">RETURN VALUE</p>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((ifs (<a href="#robo41">make-image-file-seq-from-dir</a> "/tmp/tl-<a href="./seq_lisp.html#robo16">seq</a>/" :pattern "*.jpg")))
  (<strong>get-image</strong> ifs 1 :in-seconds t))
;; =&gt;
IMAGE: width: 500, height: 300
NAMED-OBJECT: id: NIL, tag: NIL, 
data: #&lt;RGB-IMAGE (500x300) {7008616523}&gt;
**********
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defmethod <strong>get-image</strong> ((ifs <a href="./image_lisp.html#robo11">image</a>-file-<a href="./seq_lisp.html#robo16">seq</a>) datum
                      &amp;key
                        id
                        (default-interpolation
                         (<a href="./globals_lisp.html#robo37">get-apr-config</a> :default-interpolation))
                        in-seconds
                        warn?)
</pre>

<hr />
<a name="image2dfile2dseq2fmake2dimage2dfile2dseq2dfrom2ddir"></a>
<a name="robo41"></a><h2>image-file-seq/make-image-file-seq-from-dir [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo12">image-file-seq</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-06
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This function instantiates an <a href="#robo12">image-file-seq</a> object from a given directory,
 assuming it contains numerically named <a href="./image_lisp.html#robo11">image</a> files which constitute an
 <a href="./image_lisp.html#robo11">image</a> sequence.
 The data slot will hold the pathnames to the <a href="./image_lisp.html#robo11">image</a> files, with an id derived
 from the numerical filename (e.g. 0021.png will result in the id 21). 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> The path to the directory containing the <a href="./image_lisp.html#robo11">image</a> files. 
</pre>
<p class="item_name">OPTIONAL ARGUMENTS</p>
<pre> keyword-arguments:
 - :id. The id of the <a href="#robo12">image-file-seq</a>
 - :fps. The frame rate related to the <a href="./image_lisp.html#robo11">image</a> file sequence in the directory.
   This value will also be used to derive the duration (in secs) of the
   <a href="#robo12">image-file-seq</a>. Default = (<a href="./globals_lisp.html#robo37">get-apr-config</a> :fps)
 - :pattern. The search pattern used to determine files to be included in the
   <a href="#robo12">image-file-seq</a>. Default = "*.png"
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> The new <a href="#robo12">image-file-seq</a> object. 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((ifs (<strong>make-image-file-seq-from-dir</strong> "/tmp/tl-<a href="./seq_lisp.html#robo16">seq</a>/" :pattern "*.jpg")))
  (get-item ifs 0))
;; =&gt; #P"/tmp/tl-<a href="./seq_lisp.html#robo16">seq</a>/0000.jpg"
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>make-image-file-seq-from-dir</strong> (path &amp;key
                                      id
                                      (fps (<a href="./globals_lisp.html#robo37">get-apr-config</a> :fps))
                                      (pattern "*.png"))
</pre>

<hr />
<a name="image2dfile2dseq2fmake2dimage2dfile2dseq2dfrom2dvideo"></a>
<a name="robo42"></a><h2>image-file-seq/make-image-file-seq-from-video [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo12">image-file-seq</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-06
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This function instantiates an <a href="#robo12">image-file-seq</a> object from a video file. By
 doing so, it extracts one <a href="./image_lisp.html#robo11">image</a> for each frame via ffmpeg and stores them
 in the :<a href="./image_lisp.html#robo11">image</a>-files-dir or, when this argument is omitted, in the
 default-tmp-dir.
 Optionally, a :start time for the conversion can be defined, as well as a
 number of frames to extract (:num-frames, starting from :start).
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> The path to the video file. 
</pre>
<p class="item_name">OPTIONAL ARGUMENTS</p>
<pre> keyword-arguments:
 - :<a href="./image_lisp.html#robo11">image</a>-files-dir. The directory where the <a href="./image_lisp.html#robo11">image</a> files retrieved from the
   video file will be stored. When NIL, a path relative to the
   (<a href="./globals_lisp.html#robo37">get-apr-config</a> :default-tmp-dir) will be generated.
 - :id. The id of the <a href="#robo12">image-file-seq</a> object.
 - :pattern. The search pattern used to determine files to be included in the
   <a href="#robo12">image-file-seq</a>. NB: This should be "in sync" with the nomenclature/suffix
   indicated by the :outfile-pattern. Default = "*.png"
 - :outfile-pattern. The filename pattern used for generating names for the
   output <a href="./image_lisp.html#robo11">image</a> files. Default = "%04d.png"
 - :fps. The frame rate used to extract images from the video file.
   Default = (<a href="./globals_lisp.html#robo37">get-apr-config</a> :fps)
 - :start. The datum in the video file to start <a href="./image_lisp.html#robo11">image</a> extraction, in seconds.
   Default = 0
 - :num-frames. An integer indicating the number of frames to extract from
   the :start datum. When NIL, the video will be processed until the end.
 - :verbose. Print more information on the process.
   Default = (<a href="./globals_lisp.html#robo37">get-apr-config</a> :verbose)
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> The new <a href="#robo12">image-file-seq</a> object. 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((ifs (<strong>make-image-file-seq-from-video</strong> "/tmp/test.mp4" :fps 30)))
  (<a href="#robo39">get-frame</a> ifs 20))
;; =&gt; #P"/tmp/apparence/f36a9a14-4873-4f23-8ee7-f9b9860e43cf/0020.png"

;; NOTE: There is also a "shortcut" to this function:

(video-&gt;<a href="#robo12">image-file-seq</a> "/tmp/test.mp4" :fps 1)

;; =&gt;
IMAGE-FILE-SEQ: fps: 1, duration: 5
SEQ: 
NAMED-OBJECT: id: NIL, tag: NIL, 
data: ((1 . /tmp/apparence/1057a8ef-5579-4080-a3df-89dd74dba05d/0001.png)
       (2 . /tmp/apparence/1057a8ef-5579-4080-a3df-89dd74dba05d/0002.png)
       (3 . /tmp/apparence/1057a8ef-5579-4080-a3df-89dd74dba05d/0003.png)
       (4 . /tmp/apparence/1057a8ef-5579-4080-a3df-89dd74dba05d/0004.png)
       (5 . /tmp/apparence/1057a8ef-5579-4080-a3df-89dd74dba05d/0005.png))
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>make-image-file-seq-from-video</strong> (vidfile
                                       &amp;key
                                         ;; when no value is given, the images
                                         ;; will stored in a directory relative
                                         ;; to the default-tmp-dir
                                         <a href="./image_lisp.html#robo11">image</a>-files-dir
                                         id
                                         (pattern "*.png")
                                         ;; inherited from video-&gt;<a href="./image_lisp.html#robo11">image</a>-<a href="./seq_lisp.html#robo16">seq</a>:
                                         (outfile-pattern "%04d.png")
                                         (fps (<a href="./globals_lisp.html#robo37">get-apr-config</a> :fps))
                                         (start 0)
                                         num-frames
                                         (verbose (<a href="./globals_lisp.html#robo37">get-apr-config</a> :verbose)))
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./src/image-file-seq.lisp with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.44 on 2024-04-24 21:56:39</p>
</div> <!-- footer -->
</body>
</html>
