<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="./robodoc.css" type="text/css" />
<script src="./robodoc.js"></script>
<title>compositing.lisp</title>
<!-- Source: ./src/compositing.lisp -->
<!-- Generated with ROBODoc Version 4.99.44 (Nov 13 2022) -->
</head>
<body>
<div id="logo">
<a name="robo_top_of_doc"></a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./toc_index.html#top">Table of Contents</a>
<a class="menuitem" href="./robo_sourcefiles.html#top">Sourcefiles</a>
<a class="menuitem" href="./masterindex.html#top">Index</a>
<a class="menuitem" href="./robo_generics.html#top">Generics</a>
<a class="menuitem" href="./robo_classes.html#top">Classes</a>
<a class="menuitem" href="./robo_functions.html#top">Functions</a>
<a class="menuitem" href="./robo_modules.html#top">Modules</a>
<a class="menuitem" href="./robo_methods.html#top">Methods</a>
<a class="menuitem" href="./robo_variables.html#top">Variables</a>
</div> <!-- navigation -->
<div id="content">
<hr />
<a name="apr2fcompositing"></a>
<a name="robo0"></a><h2>apr/compositing [ Modules ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="./robo_modules.html#robo_top_of_doc">Modules</a> ]</p>
<p class="item_name">NAME</p>
<pre> <strong>compositing</strong>
</pre>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-26
</pre>
<p class="item_name">PURPOSE</p>
<pre> This module implements <a href="./image_lisp.html#robo11">image</a> <strong>compositing</strong> algorithms. 

 CLASS HIERARCHY
 none. no classes defined. 

 $$ Last modified:  17:18:34 Wed Apr 24 2024 CEST
</pre>

<hr />
<a name="compositing2fa2datop2db2dfun"></a>
<a name="robo22"></a><h2>compositing/a-atop-b-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-27
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the <a href="#robo0">compositing</a> function A Atop B to be used for example in
 <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new <a href="./imago_lisp.html#robo2">imago</a>-color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>a-atop-b-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fa2din2db2dfun"></a>
<a name="robo23"></a><h2>compositing/a-in-b-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-27
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the <a href="#robo0">compositing</a> function A In B to be used for example in
 <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new <a href="./imago_lisp.html#robo2">imago</a>-color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>a-in-b-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fa2dout2db2dfun"></a>
<a name="robo24"></a><h2>compositing/a-out-b-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-27
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the <a href="#robo0">compositing</a> function A Out B to be used for example in
 <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new <a href="./imago_lisp.html#robo2">imago</a>-color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>a-out-b-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fa2dover2db2dfun"></a>
<a name="robo25"></a><h2>compositing/a-over-b-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-27
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the <a href="#robo0">compositing</a> function A Over B to be used for example in
 <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new <a href="./imago_lisp.html#robo2">imago</a>-color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>a-over-b-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fa2dover2db2dop"></a>
<a name="robo26"></a><h2>compositing/a-over-b-op [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-26
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is an implementation of the Porter/Duff A Over B <a href="#robo0">compositing</a> operator.

 Literature:
 - Porter, Thomas, und Tom Duff. 1984. „Compositing Digital Images“. In
   Proceedings of the 11th Annual Conference on Computer Graphics and
   Interactive Techniques,
   253–59. ACM. <a href="https://doi.org/10.1145/800031.808606">https://doi.org/10.1145/800031.808606</a>.
 - <a href="https://ssp.impulsetrain.com/porterduff.html">https://ssp.impulsetrain.com/porterduff.html</a>
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two rgba-lists (cf. rgba-list-p) for color a and b. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new rgba-list for the new pixel color. 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((a '(.3 .4 .6 .2))
      (b '(.4 .1 .2 .9)))
  (<strong>a-over-b-op</strong> a b))
;; =&gt; (0.37826088 0.16521741 0.28695652 0.91999996)
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>a-over-b-op</strong> (a b)
</pre>

<hr />
<a name="compositing2fa2dxor2db2dfun"></a>
<a name="robo27"></a><h2>compositing/a-xor-b-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-27
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the <a href="#robo0">compositing</a> function A Xor B to be used for example in
 <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new <a href="./imago_lisp.html#robo2">imago</a>-color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>a-xor-b-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fapr2ddefault2dcompose2dfun"></a>
<a name="robo28"></a><h2>compositing/apr-default-compose-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-26
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the default <a href="./canvas_lisp.html#robo17">compose</a> operator, to be used, e.g. via <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>.
 By default, this uses the Porter/Duff A-Over-B algorithm for generating the
 the resulting color.

 This function is meant to be used with the <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a> function.
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors, where color1 is the dest (B), and color2 is the src (A)
 color (cf. <a href="./canvas_lisp.html#robo17">compose</a>-op).
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> An <a href="./imago_lisp.html#robo2">imago</a>-color (integer). 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((c1 (<a href="./imago_lisp.html#robo2">imago</a>::make-color 23 45 19 22))
      (c2 (<a href="./imago_lisp.html#robo2">imago</a>::make-color 83 15 44 255)))
  (<strong>apr-default-compose-fun</strong> c1 c2))
;; =&gt; 4283640847
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>apr-default-compose-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fcompose2dop"></a>
<a name="robo29"></a><h2>compositing/compose-op [ Generics ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_generics.html#robo_top_of_doc">Generics</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-26
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This macro is a shortcut to apply a <a href="#robo0">compositing</a> operator (e.g. a-over-b-op)
 to two <a href="./imago_lisp.html#robo2">imago</a>-colors, as demanded by <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>. It converts both colors
 to rgba-lists (cf. rgba-list-p) to be used in the actual <a href="./canvas_lisp.html#robo17">compose</a>-operator
 and provides them in the body of the macro (accessible via the accessors as
 defined in the key arguments).

 The function <a href="#robo25">a-over-b-fun</a> illustrates a use case of this macro. 

 Note: In order to pass the resulting value back to <a href="./imago_lisp.html#robo2">imago</a>::<a href="./canvas_lisp.html#robo17">compose</a>, it is
       necessary to apply the function <a href="./imago_lisp.html#robo54">rgba-list-&gt;color</a> to the resulting
       value (if it is an rgba-list); cf. <a href="#robo25">a-over-b-fun</a>. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> - The first <a href="./imago_lisp.html#robo2">imago</a>-color (i.e. the dest-, in Porter/Duff-terms the B-color).
 - The second <a href="./imago_lisp.html#robo2">imago</a>-color (i.e. the src-, in Porter/Duff-terms the A-color).
</pre>
<p class="item_name">OPTIONAL ARGUMENTS</p>
<pre> - :a-accessor. The accessor for the a color in the body (this is the value
   of color2, as color1 is the dest and color2 is the src). Default = a.
 - :b-accessor. The accessor for the b color in the body (this is the value
   of color1, as color1 is the dest and color2 is the src). Default = b.
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((c1 (<a href="./imago_lisp.html#robo2">imago</a>::make-color 23 45 19 22))
      (c2 (<a href="./imago_lisp.html#robo2">imago</a>::make-color 83 15 44 255)))
  (<strong>compose-op</strong> (c1 c2 :a-accessor a :b-accessor b)
    (print a)
    (print b)))
;; =&gt; (in the REPL)
;; (0.3254902 0.17254902 0.058823533 1.0) 
;; (0.09019608 0.07450981 0.1764706 0.08627451) 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defmacro <strong>compose-op</strong> ((color1 color2
                       &amp;key
                         ;; Color a and be are the colors in the Porter/Duff
                         ;; sense, not in <a href="./imago_lisp.html#robo2">imago</a>'s logic.
                         ;; The colors are rgba-lists. 
                         (a-accessor 'a)
                         (b-accessor 'b))
                      &amp;body body)
</pre>

<hr />
<a name="compositing2fdifference2dfun"></a>
<a name="robo30"></a><h2>compositing/difference-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-24
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This is the <a href="#robo0">compositing</a> function for a difference value of colors A and B.
 The opacity is determined by the alpha value of B. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new <a href="./imago_lisp.html#robo2">imago</a>-color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>difference-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fmultiply2dfun"></a>
<a name="robo31"></a><h2>compositing/multiply-fun [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-04-24
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This function multiplies the colors of the two images with each other. 
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> Two <a href="./imago_lisp.html#robo2">imago</a>-colors. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> The resulting color. 
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>multiply-fun</strong> (color1 color2)
</pre>

<hr />
<a name="compositing2fporter2dduff2dcomp"></a>
<a name="robo32"></a><h2>compositing/porter-duff-comp [ Generics ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_generics.html#robo_top_of_doc">Generics</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-27
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> This macro is a general form of the Porter/Duff <a href="#robo0">compositing</a> operation (cf.
 Porter/Duff 1984). It expands to a lambda function that takes two rgba-lists
 as its arguments and returns a new rgba-list of the computed color.
 
 The two optional arguments to the macro are the fractional terms as
 described by Porter and Duff (1984, 255). They can changed according to
 the operation to implement. Cf. <a href="#robo26">a-over-b-op</a> for an example.

 Literature:
 - Porter, Thomas, und Tom Duff. 1984. „Compositing Digital Images“. In
   Proceedings of the 11th Annual Conference on Computer Graphics and
   Interactive Techniques,
   253–59. ACM. <a href="https://doi.org/10.1145/800031.808606">https://doi.org/10.1145/800031.808606</a>.
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> none to the macro.
 Arguments to the lambda function resulting during macroexpansion:
 Two rgba-lists (cf. rgba-list-p) for color a and b. 
</pre>
<p class="item_name">OPTIONAL ARGUMENTS</p>
<pre> The two fractional terms, f-a and f-b (see above).
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> A new rgba-color as a list. 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(let ((a '(.3 .4 .6 .2))
      (b '(.4 .1 .2 .9)))
  ;; this is the A Over B operation:
  (funcall (<strong>porter-duff-comp</strong> 1 (- 1 a-a)) a b))
;; =&gt; (0.37826088 0.16521741 0.28695652 0.91999996)
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defmacro <strong>porter-duff-comp</strong> (&amp;optional (f-a 1) (f-b '(- 1 a-a)))
</pre>

<hr />
<a name="compositing2frgba2dlist2dp"></a>
<a name="robo33"></a><h2>compositing/rgba-list-p [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo0">compositing</a> ] [ <a href="./robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">AUTHOR</p>
<pre> Ruben Philipp &lt;me@rubenphilipp.com&gt;
</pre>
<p class="item_name">CREATED</p>
<pre> 2024-03-26
</pre>
<p class="item_name">DESCRIPTION</p>
<pre> Tests if a given item is a rgba-list.  An rgba-list is a four-element list
 with each element e being a floating point value 0 &lt;= e &lt;= 1. The order is:
 (r b g a).
</pre>
<p class="item_name">ARGUMENTS</p>
<pre> The thing to be tested. 
</pre>
<p class="item_name">RETURN VALUE</p>
<pre> Either T or NIL. 
</pre>
<p class="item_name">EXAMPLE</p>
<pre class="source">(<strong>rgba-list-p</strong> '(1 0 1 .2)) =&gt; T
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source">(defun <strong>rgba-list-p</strong> (thing)
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./src/compositing.lisp with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.44 on 2024-04-26 00:29:05</p>
</div> <!-- footer -->
</body>
</html>
